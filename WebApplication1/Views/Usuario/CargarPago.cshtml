@using Dominio

@{
    ViewData["Title"] = "Cargar Pago";
    var gastos = (List<TipoGasto>)ViewBag.Gastos;
    var metodos = (Array)ViewBag.Metodos;
}

<h1>Cargar Nuevo Pago</h1>

<form asp-controller="Usuario" asp-action="CargarPago" method="post">

    <!-- TIPO DE PAGO -->
    <div class="mb-3">
        <label class="form-label">Tipo de Pago</label>
        <select class="form-select" id="tipoPago" name="tipoPago">
            <option value="">Seleccione...</option>
            <option value="U">Único</option>
            <option value="R">Recurrente</option>
        </select>
    </div>

    <!-- TIPO DE GASTO -->
    <select class="form-select" name="gastoNombre" required>
    <option value="">Seleccione gasto...</option>
    @foreach (var g in gastos)
    {
        <option value="@g.Nombre">@g.Nombre</option>  <!-- ✅ usamos el Nombre -->
    }
</select>


    <!-- METODO DE PAGO -->
    <div class="mb-3">
        <label class="form-label">Método de Pago</label>
        <select class="form-select" name="metodo" required>
            @foreach (var m in metodos)
            {
                <option value="@m">@m</option>
            }
        </select>
    </div>

    <!-- MONTO -->
    <div class="mb-3">
        <label class="form-label">Monto</label>
        <input class="form-control" name="monto" type="number" min="1" step="1" required />
    </div>

    <!-- CAMPOS SOLO PARA PAGO ÚNICO -->
    <div id="pagoUnicoDiv" class="mb-3" style="display:none;">
        <label class="form-label">Fecha de Pago</label>
        <input class="form-control" name="fechaUnico" type="date" />
    </div>

    <!-- CAMPOS SOLO PARA PAGO RECURRENTE -->
    <div id="pagoRecDiv" style="display:none;">
        <div class="mb-3">
            <label class="form-label">Fecha Inicio</label>
            <input class="form-control" name="fechaInicio" type="date" />
        </div>

        <div class="mb-3">
            <label class="form-label">Fecha Fin (opcional)</label>
            <input class="form-control" name="fechaFin" type="date" />
        </div>
    </div>

    <button type="submit" class="btn btn-primary">Guardar Pago</button>
</form>

<script>
    const tipoPago = document.getElementById("tipoPago");
    const pagoUnicoDiv = document.getElementById("pagoUnicoDiv");
    const pagoRecDiv = document.getElementById("pagoRecDiv");

    tipoPago.addEventListener("change", function () {
        if (this.value === "U") {
            pagoUnicoDiv.style.display = "block";
            pagoRecDiv.style.display = "none";
        }
        else if (this.value === "R") {
            pagoUnicoDiv.style.display = "none";
            pagoRecDiv.style.display = "block";
        }
        else {
            pagoUnicoDiv.style.display = "none";
            pagoRecDiv.style.display = "none";
        }
    });
</script>
